<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel = stylesheet type="text/css" href = "css/entry.css">
</head>
<body>
    <form name="fileinfo" class="form2" method="post"> <!--action="" enctype="multipart/form-data" method="post"-->
        <div>Ограничение размера < 2мб</div>
        <div>Тип файла: изображение, pdf</div>
        <input class=inp type="text" value="1249" name="message"/>
        <input type="file" name='file' class="files" onchange="readURL(this)" accept="application/pdf,image/*,image/jpeg,image/png"/>
    </form>
    <form class="form1">
        <div>
            Логин
        </div>
        <input id=login class=inp type="text" name="message"/>
        <div>
            Пароль
        </div>
        <input id=pass class=inp type="password" name="password"/>
        <input class=button id=but type="submit" name="Вход" value="Вход">

        <div class="forgot">Забыли пароль?</div>
        <input id=reg type="button" name="Регистрация" value="Регистрация">
    </form>

<button onclick="sendFile()">Отправить</button>
    <script>
        function sendFile() {
            var formData = new FormData(document.querySelector('form'));

            //formData.append('files', document.getElementById('ass').files[0]);
            console.log(formData.getAll('files'));
//
//            var formData = new FormData(document.forms.fileinfo);
//            formData.append("aaa",5242880);
//            var xhr = new XMLHttpRequest();
//            xhr.open("POST", '/file', true);
//            xhr.send(formData);
//            xhr.onreadystatechange = function () {
//                if (http.readyState == 4 && http.status == 200) {
//                    alert(xhr.responseText);
//                }
//            };
            fetch("/file", {
                method: 'post',
//                headers: {
//                    'Authorization': 'access_token',
//                    'Content-Type': 'multipart/form-data'//'application/json'
//                },
                body: formData//JSON.stringify({data: '1234567'})
            })
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
                if(data.result){
                    alert(data.data);
                }
            })
            .catch(function (err) {
                alert('catch');
            });
        }


        function readURL(input) {

            var size = 5242880; // bytes
            if(input.files[0].size> size){
                alert("Файл слишком большой");
                input.value = '';
            }
        }

        document.getElementById('but').onclick = function() {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/publish", true);
            xhr.send(JSON.stringify({
                login: document.getElementById("login").value,
                password: document.getElementById("pass").value,
                event: 'entry'
            }));
            xhr.onreadystatechange = function () {
                if (xhr.readyState != 4) return;
                alert(xhr.responseText);
                if(xhr.responseText == "Вы вошли"){
                    window.open("welcome.html", '_self');
                    return false;
                }
                document.getElementById("login").value = '';
                document.getElementById("pass").value = '';
            };
            return false;
        };

        document.getElementById('reg').onclick = function() {
            window.open("check.html", '_self');
        };
    </script>
</body>
</html>